{% extends "base.html" %}

{% block content %}
    <h1>Search item</h1>
    <form method='POST'>
        {{ form.searchType(id='types') }}
        {{ form.searchSubtype(id='subtypes') }} <br>
        {{ form.searchField1(class='search') }} {{ form.searchValue1 }}<br>
        {{ form.searchField2(class='search') }} {{ form.searchValue2 }}<br>
        {{ form.searchField3(class='search') }} {{ form.searchValue3 }}<br>
        {{ form.submit }}
    </form>



    <script>
        $(document).ready(function(){
            $("#types").change(function(){
                var jsonchoices = '{{choices|tojson|safe}}';
                var selectedType  = $("#types").val(); 
                $('#subtypes').empty();
                $('#subtypes').append($('<option/>', { 
                    value: 'None',
                    text : 'choose a subtype' 
                    }));
                $.each(JSON.parse(jsonchoices)[selectedType], function (index, value) {
                    $('#subtypes').append($('<option/>', { 
                    value: value,
                    text : value 
                    }));
                });
            });

            $("#subtypes").change(function(){
                $.getJSON('/get_searchfield', {
				  selection: $("#subtypes").val(),
				}, function(data) {
                    $(".search").empty();
                    $.each(data.result, function(i, value) {
                        $(".search").append($('<option/>', { 
                            value: i,
                            text : value 
                            }));
                        });
				});
            });
        });
    </script>
{% endblock %}